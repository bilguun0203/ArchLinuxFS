sudo: required
dist: trusty
group: deprecated-2017Q4
language: bash
before_script:
- sudo apt-get update -qq
- sudo apt-get install aria2 zip unzip check -qq
script:
- source ./env.sh
- "${DLR} ${ROOTFS_URL} -o ${ROOTFS_FN}"
- "${DLR} ${FRTCP_URL} -o ${FRTCP_FN}"
- 
- sudo tar -zxpf ${ROOTFS_FN}
- cd root.x86_64
- sudo cp -f ../profile ./etc/profile
- sudo cp -bf ../mirrorlist ./etc/pacman.d/mirrorlist
- sudo cp -bf ../pacman.conf.nosig ./etc/pacman.conf
- sudo sed -i -e "s/#en_US.UTF-8/en_US.UTF-8/" ./etc/locale.gen
- echo "LANG=en_US.UTF-8" | sudo tee ./etc/locale.conf
- sudo cp -f ../${FRTCP_FN} ./root/
- sudo cp -f /etc/resolv.conf ./etc/resolv.conf
- sudo mv -f ./etc/mtab ./etc/mtab.bak
- echo "rootfs / rootfs rw 0 0" | sudo tee ./etc/mtab
- 
- sudo mount -t proc proc proc/
- sudo mount --bind /sys sys
- 
- sudo chroot . /usr/bin/pacman -Syu --noconfirm ${PAC_PKGS}
- sudo chmod u+s ./usr/bin/ping
- sudo rm -rf ./etc/mtab
- echo "rootfs / rootfs rw 0 0" | sudo tee ./etc/mtab
- sudo chroot . /usr/bin/locale-gen
- yes | sudo chroot . /usr/bin/pacman -U --force /root/${FRTCP_FN}
- yes | sudo chroot . /usr/bin/pacman -Scc
- 
- sudo cp -f ../sudoers ./etc/sudoers
- 
- sudo umount ./{sys,proc}
- sudo mv -f ./etc/mtab.bak ./etc/mtab
- sudo cp -f ../pacman.conf ./etc/pacman.conf
- echo "# This file was automatically generated by WSL. To stop automatic generation
  of this file, remove this line." | sudo tee ./etc/resolv.conf
- 
- sudo rm -rf `sudo find ./root/ -type f`
- sudo rm -rf `sudo find ./var/cache/pacman/pkg/ -type f`
- 
- sudo tar -zcpf ../rootfs.tar.gz *
- sudo chown `id -un` ../rootfs.tar.gz
- cd ..
- mkdir out
- mv -f rootfs.tar.gz ./out/
notifications:
  email: false
deploy:
  provider: releases
  api_key:
    secure: dFg1do5ljDAgD5nEkae/5Biw4SSC574D+JPO6+wsD1Sq0foQ6/Q77N0d83XLmBPlMcxDmE5XZU87MzEPJwfeVdpm7vv5Ykf4FceVdIhdTlU1eM3H4+4n60evX7Q9yGs1NiPA5A4rMhpyVE0ILgVfjShXZMdFOZ7aDckb67OEsXnrHMIHd37wJ7LpfE4AVM9pXq111+upA3kny38Mm9fnEX6O7Of36KXWR979BviSpaGkZT6vpFLiWDIhvjWr+PaL5kMmUnRGuB224SvHGx+VmugaXz3PVQeop5FvvaMFM4dAuABx9rmnnH4XlxqfkkbwBWF7Gb+RECMu9pFZPwqEUVkrSWjZUG3TbHfuvMqsNLqrYPI6IIc2oP5KXU9j34SLeXGDSQjNez9jkb/uYph23itqmM6StJkMbfmVudeqaaBSUj7tfVUVevRUaVvI4mm+5AUZIJTlM7W3fyq5Ea1ZYDDSzAlpP5NPWP8ToFSYz89ywbx/cNSa6kKFr9dCFGJVnkRfuuRRM9G34Kn9CvCXX6L/cVbP5POOcw5I5HTIN1CriHzGW9a4uognY8pDbp8Gc2qBb32XlTGdZKvyUFEjnSAzbkw7jwo4mCvKMMdUMSsva6JDx1VB1JhOMtCdYO9C0QdYFyHcq0OjtJ0jixfOUhTVnAdrodXTD4CWwYNurHk=
  file: out/rootfs.tar.gz
  skip_cleanup: true
  on:
    repo: bilguun0203/ArchLinuxFS
    tags: true
    all_branches: true
